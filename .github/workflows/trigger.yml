name: trigger
# run this workflow on trigger or manually
on:
  # trigger this workflow by calling GitHub API
  repository_dispatch:
    types: [trigger-tests]
  # trigger this workflow from GitHub Actions UI
  workflow_dispatch:
    inputs:
      pullRequestNumber:
        description: Test the deployed PR number
        required: false
        type: number
jobs:
  tests:
    runs-on: ubuntu-latest
    steps:
      - name: Print variables 🖨️
        run: |
          echo '### Workflow info 🖨️' >> $GITHUB_STEP_SUMMARY
          echo 'PR number ${{ github.event.client_payload.pullRequestNumber || github.event.inputs.pullRequestNumber }}' >> $GITHUB_STEP_SUMMARY
          echo 'original repo ${{ github.event.client_payload.repo }}' >> $GITHUB_STEP_SUMMARY

      - name: Post workflow URL 🔗
        if: ${{ github.event.client_payload.repo && github.event.client_payload.feedbackCommentId }}
        uses: peter-evans/create-or-update-comment@v3
        with:
          # need a personal token to be able to post a comment back
          # in the original repo
          token: ${{ secrets.PERSONAL_TOKEN }}
          comment-id: ${{ github.event.client_payload.feedbackCommentId }}
          issue-number: ${{ github.event.client_payload.pullRequestNumber }}
          repository: bahmutov/${{ github.event.client_payload.repo }}
          body: Tests workflow at $GITHUB_SERVER_URL/$GITHUB_REPOSITORY/actions/runs/$GITHUB_RUN_ID
